<html>

<head>
<style type="text/css">
.inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.left {
  text-align: left;
}
.right {
  text-align: right;
}
.center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.sng {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.def {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
<title>Facebook Network Analysis</title>
</head>

<body>

<p><b>Description</b>: This document shows the output of the rmd file for my analysis of a set of Facebook network data. It includes visualizations for the network, degree centrality and eigenvector centrality.<br>
<b>Author<b>: Jennifer Haliewicz<br>
<b>Course</b>: Info 523, Data Mining</p>

<div class="chunk" id="unnamed-chunk-1"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com">#load needed libraries</span>

<span class="hl kwd">library</span>(Matrix)
<span class="hl kwd">library</span>(ggplot2)
<span class="hl kwd">library</span>(igraph)
<span class="hl kwd">library</span>(reshape2)
<span class="hl kwd">library</span>(RColorBrewer)
<span class="hl kwd">library</span>(ggraph)
<span class="hl kwd">library</span>(tidygraph)
<span class="hl kwd">library</span>(HiveR)

<span class="hl com">#set file path to facebook edge data</span>
data_path = <span class="hl sng">&quot;C:/Users/roflj/Documents/info523/presentation/facebook_combined.txt&quot;</span>

<span class="hl com"># Read Facebook edge data</span>
edge_data &lt;- <span class="hl kwd">read.table</span>(data_path, header = <span class="hl kwa">FALSE</span>, col.names = <span class="hl kwd">c</span>(<span class="hl sng">&quot;Source&quot;</span>, <span class="hl sng">&quot;Target&quot;</span>))

<span class="hl com"># Set seed <span class="hl kwa">for</span> reproducibility</span>
<span class="hl kwd">set.seed</span>(123)

<span class="hl com"># Count rows and sample 10%</span>
num_rows &lt;- <span class="hl kwd">nrow</span>(edge_data)
num_sampled_rows &lt;- <span class="hl kwd">ceiling</span>(0.1 * num_rows)
sampled_rows &lt;- <span class="hl kwd">sample</span>(num_rows, num_sampled_rows)
subset_fb_edges &lt;- edge_data[sampled_rows, ]

<span class="hl com"># Create graph object</span>
g &lt;- <span class="hl kwd">graph_from_data_frame</span>(subset_fb_edges, directed = <span class="hl kwa">FALSE</span>)

<span class="hl com"># Compute node degrees</span>
node_degrees &lt;- <span class="hl kwd">degree</span>(g)

<span class="hl com"># Assign colors based on node degree</span>
color_gradient &lt;- <span class="hl kwd">colorRampPalette</span>(<span class="hl kwd">c</span>(<span class="hl sng">&quot;lightblue&quot;</span>, <span class="hl sng">&quot;darkblue&quot;</span>))
node_colors &lt;- <span class="hl kwd">color_gradient</span>(<span class="hl kwd">max</span>(node_degrees))[node_degrees]

<span class="hl com"># Plot network using Kamada-Kaway layout</span>
layout_kk &lt;- <span class="hl kwd">layout_with_kk</span>(g)
scale_factor &lt;- 50
layout_kk_adjusted &lt;- layout_kk * scale_factor

network_plot &lt;- <span class="hl kwd">plot</span>(
  g,
  layout = layout_kk_adjusted,
  vertex.size = 5,
  vertex.color = node_colors,
  vertex.label = <span class="hl kwa">NA</span>,
  edge.width = 1,
  edge.arrow.size = 0.2,
  edge.color = <span class="hl sng">&quot;gray80&quot;</span>,
  main = <span class="hl sng">&quot;Network Visualization with Kamada-Kaway Layout&quot;</span>,
  vertex.frame.color = NA
)

<span class="hl kwd">print</span>(network_plot)

<span class="hl com"># Compute centralities</span>
degree_centrality &lt;- <span class="hl kwd">degree</span>(g)
eigenvector_centrality &lt;- <span class="hl kwd">eigen_centrality</span>(g)$vector

<span class="hl com"># Prepare node and edge data frames</span>
vertices &lt;- <span class="hl kwd">data.frame</span>(
  name = <span class="hl kwd">V</span>(g)$name,
  degree_centrality = degree_centrality,
  eigenvector_centrality = eigenvector_centrality
)
edges &lt;- <span class="hl kwd">data.frame</span>(
  from = <span class="hl kwd">as.integer</span>(<span class="hl kwd">factor</span>(subset_fb_edges$Source, levels = <span class="hl kwd">V</span>(g)$name)),
  to = <span class="hl kwd">as.integer</span>(<span class="hl kwd">factor</span>(subset_fb_edges$Target, levels = <span class="hl kwd">V</span>(g)$name))
)
graph_tbl &lt;- <span class="hl kwd">tbl_graph</span>(nodes = vertices, edges = edges)

<span class="hl com"># Plot degree centrality using circlepack layout</span>
<span class="hl kwd">set.seed</span>(1)
dc_plot &lt;- <span class="hl kwd">ggraph</span>(graph_tbl, layout = <span class="hl sng">'circlepack'</span>) +
  <span class="hl kwd">geom_node_circle</span>(<span class="hl kwd">aes</span>(fill = degree_centrality), linewidth = 0.25, n = 50) +
  <span class="hl kwd">geom_edge_link</span>() +
  <span class="hl kwd">scale_fill_gradient</span>(low = <span class="hl sng">&quot;lightblue&quot;</span>, high = <span class="hl sng">&quot;darkblue&quot;</span>) +
  <span class="hl kwd">coord_fixed</span>() +
  <span class="hl kwd">ggtitle</span>(<span class="hl sng">&quot;Degree Centrality Visualization with Circlepack Layout&quot;</span>) +
  <span class="hl kwd">theme_graph</span>()

<span class="hl kwd">print</span>(dc_plot)

<span class="hl com"># Define bins <span class="hl kwa">for</span> eigenvector centrality</span>
num_bins &lt;- 5
breaks &lt;- <span class="hl kwd">quantile</span>(vertices$eigenvector_centrality, probs = <span class="hl kwd">seq</span>(0, 1, length.out = num_bins + 1))
colors &lt;- <span class="hl kwd">c</span>(<span class="hl sng">&quot;Low&quot;</span> = <span class="hl sng">&quot;pink&quot;</span>, <span class="hl sng">&quot;Medium-Low&quot;</span> = <span class="hl sng">&quot;turquoise&quot;</span>, <span class="hl sng">&quot;Medium&quot;</span> = <span class="hl sng">&quot;gold&quot;</span>, <span class="hl sng">&quot;Medium-High&quot;</span> = <span class="hl sng">&quot;orange&quot;</span>, <span class="hl sng">&quot;High&quot;</span> = <span class="hl sng">&quot;darkred&quot;</span>)
vertices$size &lt;- scales::<span class="hl kwd">rescale</span>(vertices$eigenvector_centrality, to = <span class="hl kwd">c</span>(1, 5))
vertices$bin &lt;- <span class="hl kwd">cut</span>(vertices$eigenvector_centrality, breaks = breaks, labels = <span class="hl kwd">names</span>(colors), include.lowest = <span class="hl kwa">TRUE</span>)

<span class="hl com"># Create Fruchterman-Reingold layout</span>
graph_igraph &lt;- <span class="hl kwd">as.igraph</span>(graph_tbl)
layout_fr &lt;- <span class="hl kwd">layout_with_fr</span>(graph_igraph, niter = 10000)

<span class="hl com"># Plot eigenvector centrality</span>
eigen_plot &lt;- <span class="hl kwd">ggraph</span>(graph_tbl, layout = layout_fr) +
  <span class="hl kwd">geom_edge_link</span>(color = <span class="hl sng">&quot;gray80&quot;</span>) +
  <span class="hl kwd">geom_node_point</span>(<span class="hl kwd">aes</span>(color = bin, size = size)) +
  <span class="hl kwd">scale_color_manual</span>(values = colors, name = <span class="hl sng">&quot;Eigenvector Centrality Bin&quot;</span>) +
  <span class="hl kwd">scale_size_continuous</span>(range = <span class="hl kwd">c</span>(1, 5), name = <span class="hl sng">&quot;Node Size&quot;</span>) +
  <span class="hl kwd">ggtitle</span>(<span class="hl sng">&quot;Eigenvector Centrality Visualization with Custom Legends&quot;</span>) +
  <span class="hl kwd">theme_graph</span>()

<span class="hl kwd">print</span>(eigen_plot)

&lt;/body&gt;
&lt;/html&gt;
</pre></div>
<div class="error"><pre class="knitr r">## Error: &lt;text&gt;:107:1: unexpected '&lt;'
## 106: 
## 107: &lt;
##      ^
</pre></div>
</div></div>
